<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <title>–¢–∞–π–º–µ—Ä –ü–æ–º–æ–¥–æ—Ä–æ</title>
  <style>
    body {
        font-family: Arial, sans-serif;
        text-align: center;
        margin: 50px;
    }
    .timer {
        font-size: 48px;
        margin: 20px;
    }
    .controls {
        margin-top: 20px;
    }
    button {
        padding: 10px 20px;
        font-size: 18px;
        margin: 5px;
        cursor: pointer;
    }
    .start { background-color: green; color: white; }
    .pause { background-color: orange; color: white; }
    .reset { background-color: red; color: white; }
    .set-time { background-color: blue; color: white; }
    input {
        font-size: 18px;
        padding: 5px;
        width: 50px;
        text-align: center;
    }
  </style>
</head>
<body>
<h1>–¢–∞–π–º–µ—Ä –ü–æ–º–æ–¥–æ—Ä–æ üçÖ</h1>

<div>
  <label for="customTime">–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Ä–µ–º—è (–º–∏–Ω):</label>
  <input type="number" id="customTime" min="1" max="120" value="25">
  <button class="set-time" onclick="setCustomTime()">–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</button>
</div>

<div class="timer" id="timer">25:00</div>

<div class="controls">
  <button class="start" onclick="startTimer()">–°—Ç–∞—Ä—Ç</button>
  <button class="pause" onclick="pauseTimer()">–ü–∞—É–∑–∞</button>
  <button class="reset" onclick="resetTimer()">–°–±—Ä–æ—Å</button>
  <a href="/tasks" class="btn back-button">üîô –ù–∞–∑–∞–¥ –∫ –∑–∞–¥–∞—á–∞–º</a>
</div>

<style>
  .back-button {
      background-color: #dc3545; /* –ö—Ä–∞—Å–Ω–∞—è –∫–Ω–æ–ø–∫–∞ */
      color: white;
      padding: 10px 20px;
      font-size: 18px;
      text-decoration: none;
      border-radius: 5px;
      display: inline-block;
      margin-top: 10px;
  }

  .back-button:hover {
      background-color: #c82333;
  }
</style>

<!-- –ê—É–¥–∏–æ –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
<audio id="alarm-sound" src="alarm.mp3"></audio>

<script>
  let timeLeft = 25 * 60;
  let timerInterval;
  let isRunning = false;

  function updateDisplay() {
      const minutes = Math.floor(timeLeft / 60);
      const seconds = timeLeft % 60;
      document.getElementById("timer").innerText =
          `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
  }

  function startTimer() {
      if (!isRunning) {
          isRunning = true;
          timerInterval = setInterval(() => {
              if (timeLeft > 0) {
                  timeLeft--;
                  updateDisplay();
              } else {
                  clearInterval(timerInterval);
                  isRunning = false;
                  playAlarm();
                  showNotification();
              }
          }, 1000);
      }
  }

  function pauseTimer() {
      clearInterval(timerInterval);
      isRunning = false;
  }

  function resetTimer() {
      clearInterval(timerInterval);
      isRunning = false;
      setCustomTime();
  }

  function setCustomTime() {
      let customMinutes = parseInt(document.getElementById("customTime").value);
      if (!isNaN(customMinutes) && customMinutes > 0 && customMinutes <= 120) {
          timeLeft = customMinutes * 60;
          updateDisplay();
      } else {
          alert("–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –≤—Ä–µ–º—è (1-120 –º–∏–Ω—É—Ç)");
      }
  }

  function playAlarm() {
      let alarm = document.getElementById("alarm-sound");
      alarm.play();
  }

  function showNotification() {
      if (Notification.permission === "granted") {
          let notification = new Notification("‚è≥ –í—Ä–µ–º—è –≤—ã—à–ª–æ!", {
              body: "–°–µ—Å—Å–∏—è –∑–∞–∫–æ–Ω—á–µ–Ω–∞! –û—Ç–¥–æ—Ö–Ω–∏ –Ω–µ–º–Ω–æ–≥–æ! üòä",
              icon: "tomato.png"
          });

          notification.onclick = function () {
              window.focus();
          };
      } else if (Notification.permission !== "denied") {
          Notification.requestPermission().then(permission => {
              if (permission === "granted") {
                  showNotification();
              }
          });
      }
  }
  updateDisplay();
</script>
</body>
</html>
